<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akademi Anti-Fraud Kopkar AKM</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        /* --- PERBAIKAN CSS CETAK --- */
        @media print {
            /* Sembunyikan semua elemen dengan class no-print */
            .no-print, .no-print * {
                display: none !important;
                height: 0 !important;
                width: 0 !important;
                overflow: hidden !important;
            }

            /* Paksa Area Cetak untuk muncul */
            .print-area {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background-color: white;
            }

            /* Pastikan warna background tercetak (untuk sertifikat) */
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            
            /* Reset margin halaman agar full page */
            @page {
                size: auto;
                margin: 0mm;
            }
            body {
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- KONFIGURASI ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBMEhQlXyh9dwCX9d-WnU71c42y2kNdLHrCaJ4Ku4v-UoavPA7ZvK7PrvOmv5FmwBz_g/exec"; 
        const LOGO_URL = "https://i.ibb.co.com/WvTwLMn5/image-1.png";
        const STORAGE_KEY = 'fraud_edu_state_v1';

        // --- KOMPONEN IKON ---
        const Icon = ({ path, className, color }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ color }}>{path}</svg>
        );
        const Shield = (props) => <Icon {...props} path={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>} />;
        const Lock = (props) => <Icon {...props} path={<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />;
        const AlertTriangle = (props) => <Icon {...props} path={<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4m0 4h.01"/>} />;
        const Brain = (props) => <Icon {...props} path={<path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/>} />;
        const XCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></>} />;
        const CheckCircle = (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></>} />;
        const ArrowRight = (props) => <Icon {...props} path={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />;
        const FileText = (props) => <Icon {...props} path={<><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>} />;
        const Printer = (props) => <Icon {...props} path={<><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></>} />;
        const Save = (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />;
        const Award = (props) => <Icon {...props} path={<><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></>} />;
        const RefreshCw = (props) => <Icon {...props} path={<><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>} />;

        // --- APLIKASI UTAMA ---
        const EdukasiFraudApp = () => {
            const [activeModules, setActiveModules] = useState([]); 
            const [currentModule, setCurrentModule] = useState(0);
            const [step, setStep] = useState('intro'); 
            const [scenarioIdx, setScenarioIdx] = useState(0);
            const [quizIdx, setQuizIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [showFeedback, setShowFeedback] = useState(false);
            const [feedbackData, setFeedbackData] = useState({ type: '', msg: '' });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [printMode, setPrintMode] = useState('none');
            const [dataRestored, setDataRestored] = useState(false);
            
            const [formData, setFormData] = useState({
                nama: '', nik: '', jabatan: 'Pengurus', unit: '', hp: '',
                tanggal: new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })
            });

            // --- MASTER DATA ---
            const MASTER_MODULES = [
                {
                    title: "MODUL 1: Membedah Anatomi Fraud",
                    icon: <AlertTriangle className="text-red-500 w-6 h-6" />,
                    content: (
                        <div className="space-y-6 text-sm leading-relaxed text-gray-700">
                            <div className="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                                <p className="font-bold text-gray-900 mb-1">Apa itu Fraud?</p>
                                <p>Fraud bukan sekadar "mencuri". Di koperasi, fraud adalah <span className="font-bold">penipuan yang disengaja</span> untuk keuntungan pribadi yang merugikan aset atau nama baik organisasi.</p>
                            </div>

                            <div>
                                <h3 className="font-bold text-gray-900 border-b pb-1 mb-2">3 Jenis Utama (ACFE Tree):</h3>
                                <ul className="space-y-3">
                                    <li className="flex gap-3">
                                        <div className="min-w-[4px] bg-blue-500 h-auto rounded"></div>
                                        <div>
                                            <strong className="block text-gray-800">1. Penyalahgunaan Aset (Asset Misappropriation)</strong>
                                            Ini paling sering terjadi (80% kasus). Contoh: Mengambil kas kecil, memakai inventaris kantor untuk pribadi, atau modus <em>Lapping</em> (memakai uang setoran anggota untuk menutupi setoran lain).
                                        </div>
                                    </li>
                                    <li className="flex gap-3">
                                        <div className="min-w-[4px] bg-blue-500 h-auto rounded"></div>
                                        <div>
                                            <strong className="block text-gray-800">2. Kecurangan Laporan (Financial Statement Fraud)</strong>
                                            Memanipulasi angka agar laporan terlihat "sehat". Contoh: <em>Window Dressing</em> (mencatat pendapatan fiktif agar SHU terlihat besar di RAT).
                                        </div>
                                    </li>
                                    <li className="flex gap-3">
                                        <div className="min-w-[4px] bg-blue-500 h-auto rounded"></div>
                                        <div>
                                            <strong className="block text-gray-800">3. Korupsi</strong>
                                            Penyalahgunaan wewenang. Contoh: Menerima <em>Kickback</em> (komisi rahasia) dari vendor, atau memberi pinjaman ke kerabat tanpa jaminan (Konflik Kepentingan).
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    ),
                    scenarios: [
                        {
                            title: "Kasus 1: Setoran 'Parkir'",
                            desc: "Budi (kolektor) terima angsuran tunai Rp 1 Juta hari Jumat sore. Karena admin sudah pulang, Budi memakai uang itu untuk belanja bulanan dan berencana menyetorkannya hari Senin saat gajian. Apakah ini fraud?",
                            options: [
                                { text: "Bukan, karena uangnya pasti diganti hari Senin.", type: "error", feedback: "SALAH. Ini disebut 'Lapping'. Memakai uang koperasi untuk kepentingan pribadi, walau sedetik, adalah fraud." },
                                { text: "Ya, ini adalah penyalahgunaan aset.", type: "success", feedback: "BENAR. Uang anggota harus langsung disetor atau disimpan di brankas kantor, bukan di dompet pribadi." }
                            ]
                        },
                        {
                            title: "Kasus 2: Toko Milik Istri",
                            desc: "Pak Rahmat (Ketua Tim Pengadaan) membeli ATK senilai Rp 50 Juta di toko milik istrinya tanpa membandingkan harga dengan toko lain. Harganya pun sedikit di atas pasar.",
                            options: [
                                { text: "Wajar, hitung-hitung membantu usaha keluarga pengurus.", type: "error", feedback: "SALAH. Ini adalah 'Konflik Kepentingan'. Koperasi dirugikan karena membayar lebih mahal." },
                                { text: "Fraud kategori Korupsi.", type: "success", feedback: "BENAR. Harusnya ada perbandingan harga 3 vendor (bidding) agar adil dan transparan." }
                            ]
                        }
                    ],
                    quizzes: [
                        { q: "Tindakan memoles laporan keuangan agar terlihat untung besar padahal rugi disebut...", options: ["Mark Up", "Window Dressing", "Lapping"], ans: 1 },
                        { q: "Menerima komisi rahasia dari vendor termasuk kategori...", options: ["Tips Wajar", "Kickback (Korupsi)", "Jasa Perantara"], ans: 1 },
                        { q: "Apa ciri utama fraud dibanding kesalahan (error) biasa?", options: ["Ada unsur kesengajaan (Niat)", "Jumlah uangnya besar", "Dilakukan oleh atasan"], ans: 0 },
                        { q: "Pegawai fiktif yang namanya ada di gaji tapi orangnya tidak ada disebut...", options: ["Ghost Employee", "Lazy Employee", "Smart Employee"], ans: 0 },
                        { q: "Gali lubang tutup lubang setoran anggota disebut...", options: ["Kiting", "Lapping", "Skimming"], ans: 1 },
                        { q: "Memalsukan tanda tangan Ketua untuk mencairkan dana termasuk...", options: ["Kreativitas", "Forgery (Pemalsuan)", "Kelalaian"], ans: 1 }
                    ]
                },
                {
                    title: "MODUL 2: Fraud Triangle (Psikologi Pelaku)",
                    icon: <Brain className="text-blue-500 w-6 h-6" />,
                    content: (
                        <div className="space-y-6 text-sm leading-relaxed text-gray-700">
                            <p>Mengapa orang baik bisa berbuat jahat? Riset Donald Cressey menunjukkan adanya 3 kondisi yang harus bertemu (Segitiga Api Fraud):</p>
                            
                            <div className="grid gap-4">
                                <div className="bg-white p-3 rounded border border-gray-200 shadow-sm">
                                    <strong className="text-red-600 block mb-1">1. Tekanan (Pressure)</strong>
                                    Dorongan kebutuhan mendesak yang "memalukan" untuk diceritakan.
                                    <br/><span className="text-xs text-gray-500">Contoh: Terlilit hutang pinjol, judi online, atau gaya hidup hedon di luar kemampuan gaji.</span>
                                </div>
                                
                                <div className="bg-white p-3 rounded border border-gray-200 shadow-sm">
                                    <strong className="text-red-600 block mb-1">2. Kesempatan (Opportunity)</strong>
                                    Celah dalam sistem yang memungkinkan seseorang mencuri tanpa ketahuan. 
                                    <br/><span className="text-xs text-gray-500">Contoh: Password dishare ("admin123"), tidak ada audit rutin, atau kasir merangkap pembukuan.</span>
                                </div>

                                <div className="bg-white p-3 rounded border border-gray-200 shadow-sm">
                                    <strong className="text-red-600 block mb-1">3. Pembenaran (Rationalization)</strong>
                                    Dialog mental untuk membenarkan tindakan salah agar hati tenang.
                                    <br/><span className="text-xs text-gray-500">Contoh: "Saya cuma pinjam sebentar", "Gaji saya terlalu kecil untuk kerja seberat ini", atau "Semua orang juga melakukannya".</span>
                                </div>
                            </div>
                            
                            <p className="bg-yellow-100 p-3 rounded text-yellow-800 text-xs font-bold">
                                CATATAN PENTING: Kita sulit mengontrol Tekanan & Pembenaran orang lain. Satu-satunya yang bisa Manajemen kontrol penuh adalah menutup KESEMPATAN.
                            </p>
                        </div>
                    ),
                    scenarios: [
                        {
                            title: "Kasus 1: Password Bersama",
                            desc: "Agar pekerjaan cepat selesai, Manajer memutuskan membuat satu password umum 'admin123' yang bisa dipakai semua staf untuk login sistem.",
                            options: [
                                { text: "Efisien, mempercepat operasional.", type: "error", feedback: "SALAH. Efisiensi tidak boleh mengorbankan keamanan." },
                                { text: "Membuka Kesempatan (Opportunity) besar.", type: "success", feedback: "BENAR. Jika ada transaksi fiktif, tidak ada yang tahu siapa pelakunya karena jejak audit (log) menjadi tidak valid." }
                            ]
                        },
                        {
                            title: "Kasus 2: Gaya Hidup Hedon",
                            desc: "Seorang staf admin dengan gaji UMR tiba-tiba sering memamerkan tas mewah dan liburan ke luar negeri di media sosial. Bulan depan, ditemukan selisih kas yang mencurigakan.",
                            options: [
                                { text: "Itu privasi dia, tidak perlu curiga.", type: "error", feedback: "SALAH. Perubahan gaya hidup drastis adalah 'Red Flag' (tanda bahaya) adanya Tekanan/Pressure finansial." },
                                { text: "Perlu waspada dan lakukan audit investigasi.", type: "success", feedback: "BENAR. Seringkali fraud dilakukan untuk membiayai gaya hidup di luar kemampuan." }
                            ]
                        }
                    ],
                    quizzes: [
                        { q: "Kalimat: 'Saya sudah kerja keras 10 tahun tapi tidak diapresiasi, wajar saya ambil bonus sedikit', adalah contoh...", options: ["Tekanan (Pressure)", "Kesempatan (Opportunity)", "Pembenaran (Rationalization)"], ans: 2 },
                        { q: "Dari 3 faktor Fraud Triangle, mana yang PALING BISA dikendalikan oleh manajemen Koperasi?", options: ["Tekanan Pribadi Karyawan", "Kesempatan (Sistem & SOP)", "Pembenaran Moral"], ans: 1 },
                        { q: "Hutang Pinjol atau Judi Online biasanya masuk dalam faktor apa?", options: ["Tekanan (Pressure)", "Kesempatan", "Korupsi"], ans: 0 },
                        { q: "Lemari brankas yang kuncinya digantung di pintu adalah contoh...", options: ["Tekanan", "Kesempatan", "Pembenaran"], ans: 1 },
                        { q: "Perubahan gaya hidup mendadak (hedon) seringkali menjadi sinyal...", options: ["Red Flag Fraud", "Kesuksesan Karir", "Warisan"], ans: 0 },
                        { q: "Merasa 'hanya meminjam sementara' padahal mengambil tanpa ijin adalah bentuk...", options: ["Niat baik", "Rasionalisasi", "Tekanan"], ans: 1 }
                    ]
                },
                {
                    title: "MODUL 3: Dampak & 4 Tameng Pertahanan",
                    icon: <Shield className="text-green-500 w-6 h-6" />,
                    content: (
                        <div className="space-y-6 text-sm leading-relaxed text-gray-700">
                            <div>
                                <h3 className="font-bold text-gray-900 mb-2">Dampak Fatal (Efek Domino):</h3>
                                <ul className="list-disc pl-5 space-y-1">
                                    <li><strong>Rush Money:</strong> Isu ketidakjujuran membuat anggota panik dan menarik simpanan massal. Koperasi bisa bangkrut dalam hitungan hari.</li>
                                    <li><strong>Pidana Penjara:</strong> Dijerat Pasal 374 KUHP (Penggelapan dalam Jabatan) dengan ancaman 5 tahun penjara.</li>
                                    <li><strong>Karir Hancur:</strong> Masuk daftar hitam (blacklist) dunia kerja.</li>
                                </ul>
                            </div>

                            <div className="bg-gray-50 p-4 rounded-lg">
                                <h3 className="font-bold text-blue-900 mb-3">Strategi 4 Tameng Pertahanan:</h3>
                                <div className="space-y-3">
                                    <div>
                                        <span className="font-bold text-green-700 block">1. Prevention (Pencegahan)</span>
                                        Terapkan <em>Segregation of Duty</em> (Pisahkan tugas pencatat & pemegang uang) dan <em>Dual Control</em> (Tanda tangan minimal 2 orang).
                                    </div>
                                    <div>
                                        <span className="font-bold text-blue-700 block">2. Detection (Deteksi)</span>
                                        Lakukan <em>Surprise Audit</em> (Sidak kas dadakan) dan aktifkan <em>Whistleblowing System</em> (Saluran lapor rahasia).
                                    </div>
                                    <div>
                                        <span className="font-bold text-yellow-700 block">3. Investigation (Investigasi)</span>
                                        Cari fakta & bukti valid, bukan berasumsi, saat ada indikasi kecurangan.
                                    </div>
                                    <div>
                                        <span className="font-bold text-red-700 block">4. Enforcement (Penindakan)</span>
                                        Sanksi tegas tanpa pandang bulu (Zero Tolerance). Pecat dan proses hukum pelakunya agar ada efek jera.
                                    </div>
                                </div>
                            </div>
                        </div>
                    ),
                    scenarios: [
                        {
                            title: "Kasus 1: Tanda Tangan Cek Kosong",
                            desc: "Manajer meminta Anda menandatangani beberapa lembar cek kosong untuk 'jaga-jaga' kalau ada pembayaran mendadak saat dia dinas luar kota.",
                            options: [
                                { text: "Tolak. Itu melanggar prinsip Dual Control.", type: "success", feedback: "BENAR. Cek kosong adalah celah fraud paling fatal. Jangan pernah lakukan, apapun alasannya." },
                                { text: "Turuti karena perintah atasan.", type: "error", feedback: "SALAH. Kepatuhan pada atasan berhenti saat perintahnya melanggar prinsip keamanan aset." }
                            ]
                        },
                        {
                            title: "Kasus 2: Teman Sendiri",
                            desc: "Anda melihat teman akrab Anda melakukan mark-up harga pembelian kopi kantor. Dia memohon agar Anda tidak melapor karena sedang butuh uang.",
                            options: [
                                { text: "Lapor lewat Whistleblowing System.", type: "success", feedback: "BENAR. Melindungi pencuri berarti mengkhianati seluruh anggota koperasi tempat kita mencari nafkah." },
                                { text: "Diam saja karena kasihan.", type: "error", feedback: "SALAH. Pembiaran menjadikan Anda 'accomplice' (sekutu) dalam tindak kejahatan tersebut." }
                            ]
                        }
                    ],
                    quizzes: [
                        { q: "Pasal KUHP yang sering menjerat pelaku fraud penggelapan dalam jabatan adalah...", options: ["Pasal 378", "Pasal 374", "Pasal 362"], ans: 1 },
                        { q: "Apa dampak terburuk fraud bagi Koperasi Simpan Pinjam?", options: ["Rugi sedikit", "Hilangnya kepercayaan (Rush Money)", "Admin lembur"], ans: 1 },
                        { q: "Apa fungsi utama 'Surprise Audit' (Pemeriksaan Dadakan)?", options: ["Mencari kesalahan staf", "Mencegah pelaku fraud menutupi jejaknya", "Iseng"], ans: 1 },
                        { q: "Sistem pelaporan pelanggaran yang menjamin kerahasiaan pelapor disebut...", options: ["Surat Kaleng", "Whistleblowing System", "Kotak Saran"], ans: 1 },
                        { q: "Kasir tidak boleh merangkap sebagai pembukuan/akunting. Ini prinsip...", options: ["Segregation of Duty", "Know Your Customer", "Dual Control"], ans: 0 },
                        { q: "Prinsip memberikan sanksi tegas kepada siapapun tanpa kecuali disebut...", options: ["Zero Tolerance", "Low Tolerance", "High Tolerance"], ans: 0 }
                    ]
                }
            ];

            // --- INITIALIZATION ---
            useEffect(() => {
                const initApp = () => {
                    const savedState = localStorage.getItem(STORAGE_KEY);
                    
                    if (savedState) {
                        try {
                            const parsed = JSON.parse(savedState);
                            setFormData(parsed.formData);
                            setScore(parsed.score);
                            setCurrentModule(parsed.currentModule);
                            setStep(parsed.step);
                            setScenarioIdx(parsed.scenarioIdx || 0);
                            setQuizIdx(parsed.quizIdx || 0);
                            
                            if (parsed.activeModules && parsed.activeModules.length > 0) {
                                setActiveModules(parsed.activeModules);
                            } else {
                                randomizeContent();
                            }
                            
                            if (parsed.step !== 'intro') {
                                setDataRestored(true);
                                setTimeout(() => setDataRestored(false), 3000);
                            }
                            return; 
                        } catch (e) {
                            console.error("Gagal load state:", e);
                            localStorage.removeItem(STORAGE_KEY);
                        }
                    }
                    randomizeContent();
                };

                const randomizeContent = () => {
                    const randomized = MASTER_MODULES.map(mod => {
                        const shuffledQuizzes = [...mod.quizzes]
                            .sort(() => 0.5 - Math.random())
                            .slice(0, 3); 
                        return { ...mod, quizzes: shuffledQuizzes };
                    });
                    setActiveModules(randomized);
                };

                initApp();
            }, []);

            // --- AUTO SAVE ---
            useEffect(() => {
                if (activeModules.length > 0) {
                    const stateToSave = {
                        formData, score, currentModule, step, scenarioIdx, quizIdx, activeModules
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(stateToSave));
                }
            }, [formData, score, currentModule, step, scenarioIdx, quizIdx, activeModules]);

            // --- HANDLERS ---
            const handleReset = () => {
                if (confirm("Yakin ingin menghapus semua progres dan mulai dari awal?")) {
                    localStorage.removeItem(STORAGE_KEY);
                    window.location.reload();
                }
            };

            const handleInputChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });
            
            // FUNGSI PRINT YANG SUDAH DIPERBAIKI
            const handlePrintDoc = (mode) => {
                setPrintMode(mode);
                // Delay 500ms memastikan React selesai render DOM cetak sebelum browser print dialog muncul
                setTimeout(() => {
                    window.print();
                }, 500);
            };

            const handleSubmit = async () => {
                if (!formData.nama || !formData.nik) { alert("Lengkapi Nama dan NIK."); return; }
                setIsSubmitting(true);
                if (GOOGLE_SCRIPT_URL) {
                    try { await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ ...formData, skor: score }) }); } 
                    catch (error) { console.error("Error", error); }
                }
                setIsSubmitting(false);
                setStep('success');
            };

            const handleNext = () => {
                setShowFeedback(false);
                if (step === 'intro') { setStep('materi'); } 
                else if (step === 'materi') { setStep('scenario'); setScenarioIdx(0); } 
                else if (step === 'scenario') {
                    if (scenarioIdx < activeModules[currentModule].scenarios.length - 1) setScenarioIdx(scenarioIdx + 1);
                    else { setStep('quiz'); setQuizIdx(0); }
                } 
                else if (step === 'quiz') {
                    if (quizIdx < activeModules[currentModule].quizzes.length - 1) setQuizIdx(quizIdx + 1);
                    else {
                        if (currentModule < activeModules.length - 1) { setCurrentModule(currentModule + 1); setStep('materi'); }
                        else { setStep('summary'); }
                    }
                }
            };

            const handleScenarioChoice = (opt) => { setFeedbackData({ type: opt.type, msg: opt.feedback }); setShowFeedback(true); };
            
            const handleQuizAnswer = (idx) => {
                const isCorrect = idx === activeModules[currentModule].quizzes[quizIdx].ans;
                if (isCorrect) { setScore(score + 1); setFeedbackData({ type: 'success', msg: "Tepat! +1 Poin" }); }
                else { setFeedbackData({ type: 'error', msg: "Kurang Tepat." }); }
                setShowFeedback(true);
            };

            if (activeModules.length === 0) return <div className="min-h-screen flex items-center justify-center">Memuat Bank Soal...</div>;

            const progressPercent = ((currentModule + (['summary','form','success'].includes(step) ? 1 : 0)) / activeModules.length) * 100;

            return (
                // Menggunakan Fragment agar div "no-print" dan "print-area" sejajar, bukan bersarang
                <React.Fragment>
                    
                    {/* --- AREA APLIKASI (DISIMPANG SAAT PRINT) --- */}
                    <div className="min-h-screen flex flex-col items-center py-4 sm:py-8 px-4 font-sans no-print">
                        
                        {/* NOTIFIKASI RESTORE */}
                        {dataRestored && (
                            <div className="fixed top-4 right-4 bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded shadow-lg z-50 animate-fade-in text-sm">
                                <strong className="font-bold">Progres Dipulihkan!</strong>
                                <span className="block sm:inline"> Kembali ke sesi terakhir Anda.</span>
                            </div>
                        )}

                        <div className="w-full max-w-lg bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col min-h-[600px] border border-gray-200 relative">
                            
                            {/* HEADER */}
                            <div className="bg-blue-900 p-5 text-white sticky top-0 z-10 shadow-md">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h1 className="text-xl font-bold flex items-center gap-2">
                                            <img src={LOGO_URL} className="w-8 h-8 object-contain bg-white rounded-full p-1" alt="Logo" />
                                            Portal Integritas & Anti-Fraud
                                        </h1>
                                        <p className="text-xs text-blue-200">Kopkar AKM - Penguatan Tata Kelola</p>
                                    </div>
                                    {['materi', 'scenario', 'quiz'].includes(step) && (
                                        <div className="text-right">
                                            <div className="text-xs opacity-75">Modul</div>
                                            <div className="font-bold text-lg">{currentModule + 1}/{activeModules.length}</div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* PROGRESS BAR */}
                            {['materi', 'scenario', 'quiz'].includes(step) && (
                                <div className="w-full bg-gray-200 h-2">
                                    <div className="bg-green-500 h-2 transition-all duration-500" style={{ width: `${progressPercent}%` }}></div>
                                </div>
                            )}

                            <div className="flex-grow p-6 overflow-y-auto pb-16"> 
                                {/* INTRO */}
                                {step === 'intro' && (
                                    <div className="text-center py-10 space-y-6 animate-fade-in">
                                        <div className="bg-blue-50 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4"><Lock className="w-12 h-12 text-blue-600" /></div>
                                        <h2 className="text-2xl font-bold text-gray-800">Selamat Datang di Portal Edukasi Integritas</h2>
                                        <p className="text-gray-600 text-sm leading-relaxed px-4">
                                            Platform pembelajaran digital untuk memperkuat tata kelola dan budaya anti-fraud di lingkungan Kopkar AKM. 
                                            <br/><br/>
                                            Materi interaktif, studi kasus nyata, dan evaluasi terukur untuk meningkatkan kompetensi dan menjaga kredibilitas organisasi.
                                        </p>
                                        <div className="bg-blue-50 p-3 rounded text-xs text-blue-800 mx-4 border border-blue-100">
                                            <strong>Fitur Smart-Save Aktif:</strong><br/>
                                            Progres Anda tersimpan otomatis. Aman untuk menutup browser sewaktu-waktu.
                                        </div>
                                        <button onClick={handleNext} className="bg-blue-700 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-800 transition transform hover:scale-105 flex items-center gap-2 mx-auto">Mulai Sesi Pembelajaran <ArrowRight className="w-5 h-5"/></button>
                                    </div>
                                )}

                                {/* MATERI */}
                                {step === 'materi' && (
                                    <div className="animate-fade-in">
                                        <div className="flex items-center gap-3 mb-6 border-b pb-4">
                                            <div className="p-2 bg-gray-100 rounded-lg">{activeModules[currentModule].icon}</div>
                                            <h2 className="text-lg font-bold text-blue-900 leading-tight">{activeModules[currentModule].title}</h2>
                                        </div>
                                        <div className="prose prose-sm max-w-none text-gray-700 mb-8">{activeModules[currentModule].content}</div>
                                        <button onClick={handleNext} className="w-full bg-blue-700 text-white py-3 rounded-lg font-bold flex justify-center items-center gap-2 hover:bg-blue-800 transition"><Brain className="w-5 h-5"/> Lanjut ke Kasus</button>
                                    </div>
                                )}

                                {/* SCENARIO */}
                                {step === 'scenario' && (
                                    <div className="animate-fade-in">
                                        <div className="bg-yellow-50 border border-yellow-200 p-2 rounded text-xs font-bold text-yellow-800 inline-block mb-4">KASUS NYATA {scenarioIdx + 1}/{activeModules[currentModule].scenarios.length}</div>
                                        <h3 className="text-lg font-bold mb-3">{activeModules[currentModule].scenarios[scenarioIdx].title}</h3>
                                        <p className="text-gray-700 mb-6 text-sm">{activeModules[currentModule].scenarios[scenarioIdx].desc}</p>
                                        {!showFeedback ? (
                                            <div className="space-y-3">
                                                {activeModules[currentModule].scenarios[scenarioIdx].options.map((opt, i) => (
                                                    <button key={i} onClick={() => handleScenarioChoice(opt)} className="w-full text-left p-4 border-2 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all font-medium text-sm">{opt.text}</button>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className={`p-5 rounded-xl border-2 ${feedbackData.type === 'success' ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} animate-fade-in`}>
                                                <div className="flex items-center gap-2 mb-2 font-bold text-lg">
                                                    {feedbackData.type === 'success' ? <CheckCircle className="text-green-600 w-6 h-6"/> : <XCircle className="text-red-600 w-6 h-6"/>}
                                                    {feedbackData.type === 'success' ? 'Keputusan Tepat' : 'Kurang Tepat'}
                                                </div>
                                                <p className="text-gray-700 mb-4 text-sm">{feedbackData.msg}</p>
                                                <button onClick={handleNext} className="w-full bg-gray-800 text-white py-3 rounded-lg font-bold text-sm hover:bg-black transition">Lanjut</button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* QUIZ (RANDOMIZED) */}
                                {step === 'quiz' && (
                                    <div className="animate-fade-in">
                                        <div className="bg-purple-50 border border-purple-200 p-2 rounded text-xs font-bold text-purple-800 inline-block mb-4">KUIS ACAK {quizIdx + 1}/{activeModules[currentModule].quizzes.length}</div>
                                        <p className="font-bold text-lg mb-6">{activeModules[currentModule].quizzes[quizIdx].q}</p>
                                        {!showFeedback ? (
                                            <div className="space-y-3">
                                                {activeModules[currentModule].quizzes[quizIdx].options.map((opt, i) => (
                                                    <button key={i} onClick={() => handleQuizAnswer(i)} className="w-full text-left p-4 bg-white border shadow-sm rounded-lg hover:bg-purple-50 hover:text-purple-700 transition font-medium text-sm">{opt}</button>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="text-center py-6 animate-fade-in">
                                                <div className={`text-lg font-bold mb-2 ${feedbackData.type === 'success' ? 'text-green-600' : 'text-red-600'}`}>{feedbackData.msg}</div>
                                                <button onClick={handleNext} className="mt-4 bg-blue-700 text-white px-8 py-3 rounded-full font-bold shadow-lg text-sm hover:bg-blue-800 transition">Lanjut</button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* SUMMARY */}
                                {step === 'summary' && (
                                    <div className="text-center py-8 animate-fade-in">
                                        <div className="text-6xl mb-4">ðŸŽ“</div>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Selesai!</h2>
                                        <div className="text-4xl font-bold text-blue-600 mb-4">{score} / 9</div>
                                        <p className="text-gray-600 mb-8 px-4 text-sm">Nilai yang bagus! Sekarang, mari resmikan komitmen Anda.</p>
                                        <button onClick={() => setStep('form')} className="w-full bg-blue-700 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition">Isi Pernyataan Komitmen</button>
                                    </div>
                                )}

                                {/* FORM */}
                                {step === 'form' && (
                                    <div className="space-y-4 animate-fade-in">
                                        <div className="bg-green-50 p-5 rounded-xl border border-green-200">
                                            <h3 className="font-bold text-green-900 flex items-center gap-2 mb-2"><FileText className="w-5 h-5"/> Form Komitmen</h3>
                                            <p className="text-xs text-green-800 mb-6">Data ini akan disimpan sebagai arsip kepatuhan.</p>
                                            <div className="space-y-4">
                                                {[{l:"Nama Lengkap", n:"nama"}, {l:"NIK / NIP", n:"nik"}, {l:"Unit Kerja", n:"unit"}, {l:"No. HP", n:"hp"}].map((f) => (
                                                    <div key={f.n}><label className="text-xs font-bold text-gray-500 uppercase">{f.l}</label><input name={f.n} value={formData[f.n]} className="w-full mt-1 p-3 border rounded-lg" onChange={handleInputChange} /></div>
                                                ))}
                                                <div>
                                                    <label className="text-xs font-bold text-gray-500 uppercase">Jabatan</label>
                                                    <select name="jabatan" value={formData.jabatan} className="w-full mt-1 p-3 border rounded-lg bg-white" onChange={handleInputChange}>
                                                        <option value="Pengurus">Pengurus</option><option value="Pengawas">Pengawas</option><option value="Pengelola">Pengelola</option><option value="Anggota">Anggota</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <button onClick={handleSubmit} disabled={isSubmitting} className={`w-full py-4 rounded-xl font-bold mt-6 flex items-center justify-center gap-2 transition ${isSubmitting ? 'bg-gray-400' : 'bg-gray-900 text-white'}`}>
                                                {isSubmitting ? 'Menyimpan...' : <><Save className="w-5 h-5" /> Simpan Data</>}
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* SUCCESS */}
                                {step === 'success' && (
                                    <div className="text-center py-8 animate-fade-in">
                                        <div className="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"><CheckCircle className="w-10 h-10 text-green-600" /></div>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Data Tersimpan!</h2>
                                        <p className="text-gray-600 mb-8 px-6 text-sm">Terima kasih, {formData.nama}. Silakan unduh dokumen:</p>
                                        <div className="space-y-4 px-4">
                                            <button onClick={() => handlePrintDoc('form')} className="w-full bg-white border-2 border-gray-300 text-gray-700 py-4 rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-50 transition shadow-sm group">
                                                <FileText className="w-5 h-5 text-gray-500 group-hover:text-gray-700"/> 
                                                <div className="text-left"><div className="text-sm">Cetak Surat Pernyataan</div><div className="text-[10px] text-gray-400 font-normal">Wajib diserahkan ke HRD</div></div>
                                            </button>
                                            <button onClick={() => handlePrintDoc('certificate')} className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-white py-4 rounded-xl font-bold flex items-center justify-center gap-3 hover:from-yellow-600 hover:to-yellow-700 transition shadow-lg ring-2 ring-offset-2 ring-yellow-200">
                                                <Award className="w-6 h-6 text-white"/> 
                                                <div className="text-left"><div className="text-base">Cetak Sertifikat</div><div className="text-[10px] text-yellow-100 font-normal">Penghargaan untuk Anda</div></div>
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* FOOTER RESET BUTTON */}
                            <div className="bg-gray-50 p-3 border-t flex justify-center no-print">
                                <button onClick={handleReset} className="flex items-center gap-2 text-xs text-gray-500 hover:text-red-500 transition">
                                    <RefreshCw className="w-3 h-3" /> Mulai Ulang / Hapus Progres
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* --- AREA CETAK (TERPISAH DARI AREA APP) --- */}
                    <div className="print-area hidden">
                        {printMode === 'form' && (
                            <div className="bg-white text-black font-serif leading-relaxed text-sm p-10 h-full">
                                <div className="text-center mb-6 border-b-2 border-black pb-4">
                                    <img src={LOGO_URL} className="w-20 h-20 mx-auto mb-2 object-contain" alt="Logo Kopkar" />
                                    <h1 className="text-2xl font-bold uppercase tracking-wider mb-1">Pernyataan Kepatuhan</h1>
                                    <h2 className="text-xl font-bold">Kebijakan Anti-Fraud Kopkar AKM</h2>
                                </div>
                                <div className="mb-6"><table className="w-full mt-2 text-base"><tbody><tr><td className="w-48 py-2">Nama Lengkap</td><td>: {formData.nama}</td></tr><tr><td className="py-2">NIK/NIP</td><td>: {formData.nik}</td></tr><tr><td className="py-2">Jabatan</td><td>: {formData.jabatan}</td></tr><tr><td className="py-2">Unit Kerja</td><td>: {formData.unit}</td></tr><tr><td className="py-2">Tanggal</td><td>: {formData.tanggal}</td></tr></tbody></table></div>
                                <div className="mb-6"><p className="mb-3">Dengan ini saya menyatakan kesungguhan hati untuk:</p><ol className="list-decimal pl-6 space-y-3 text-justify"><li><strong>Memahami Definisi Fraud:</strong> Mengerti jenis penyalahgunaan aset, manipulasi laporan, dan korupsi.</li><li><strong>Menghindari Fraud Triangle:</strong> Menjaga diri dari tekanan, menutup kesempatan, dan tidak mencari pembenaran.</li><li><strong>Menyadari Dampak:</strong> Paham risiko Rush Money dan Pidana.</li><li><strong>4 Tameng:</strong> Melakukan pencegahan, deteksi, investigasi, dan terima sanksi.</li><li><strong>Whistleblowing:</strong> Melaporkan indikasi kecurangan.</li></ol></div>
                                <div className="mt-12 flex justify-between px-8"><div className="text-center"><p className="mb-20">Yang Menyatakan,</p><p className="font-bold underline text-lg">{formData.nama}</p></div><div className="text-center"><p className="mb-20">Mengetahui,</p><p className="font-bold underline text-lg">( ........................ )</p></div></div>
                            </div>
                        )}
                        {printMode === 'certificate' && (
                            <div className="w-full h-full p-8 flex items-center justify-center bg-white">
                                <div className="w-full h-full border-8 border-double border-yellow-600 p-2 relative">
                                    <div className="absolute inset-0 opacity-5 pointer-events-none flex items-center justify-center"><Shield className="w-96 h-96"/></div>
                                    <div className="h-full border border-yellow-600 flex flex-col items-center justify-center text-center p-10">
                                        <div className="flex items-center gap-3 mb-6 text-blue-900">
                                            <img src={LOGO_URL} className="w-16 h-16 object-contain" alt="Logo Kopkar" />
                                            <div className="text-left font-sans"><div className="text-xs font-bold tracking-widest uppercase">Akademi Integritas</div><div className="text-lg font-bold">KOPKAR AKM</div></div>
                                        </div>
                                        <h1 className="text-5xl font-serif font-bold text-yellow-600 mb-2 tracking-wide" style={{ fontFamily: '"Playfair Display", serif' }}>SERTIFIKAT</h1>
                                        <h2 className="text-xl text-gray-500 uppercase tracking-widest mb-10">Kelulusan Program Anti-Fraud</h2>
                                        <p className="text-gray-600 italic mb-4 text-lg">Diberikan sebagai penghargaan kepada:</p>
                                        <div className="text-4xl font-bold text-blue-900 border-b-2 border-gray-300 pb-2 mb-6 px-10 min-w-[50%]">{formData.nama}</div>
                                        <p className="text-gray-700 max-w-2xl text-lg leading-relaxed mb-12">Telah berhasil menyelesaikan <strong>Modul Edukasi Pencegahan Fraud Dasar</strong> dengan predikat <span className="font-bold text-green-700">LULUS</span>. Sertifikat ini menjadi bukti komitmen yang bersangkutan dalam menegakkan integritas di lingkungan Koperasi Karyawan AKM.</p>
                                        <div className="w-full flex justify-between items-end px-10 mt-auto"><div className="text-center"><div className="text-gray-500 text-sm mb-16">{formData.tanggal}</div><div className="border-t border-gray-400 w-48 pt-2"><div className="font-bold text-blue-900">Fasilitator Program</div><div className="text-xs text-gray-500">Divisi Kepatuhan</div></div></div><div className="relative"><div className="w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center text-white font-bold border-4 border-yellow-300 shadow-lg rotate-12">VERIFIED</div></div><div className="text-center"><div className="text-gray-500 text-sm mb-16">Mengetahui,</div><div className="border-t border-gray-400 w-48 pt-2"><div className="font-bold text-blue-900">Ketua Pengurus</div><div className="text-xs text-gray-500">Kopkar AKM</div></div></div></div>
                                        <div className="absolute bottom-4 text-[10px] text-gray-400 font-sans">ID Sertifikat: {Math.random().toString(36).substr(2, 9).toUpperCase()} â€¢ Dokumen Digital Resmi</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </React.Fragment>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EdukasiFraudApp />);
    </script>
</body>
</html>
